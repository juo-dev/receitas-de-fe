# Design Document

## Overview

This design document covers two major initiatives:

1. **Technology Migration**: Migrate from React Native + Expo to React + Vite + Capacitor + Tailwind CSS for true web-first development with native mobile compilation
2. **Navigation Refactor**: Implement a 4-tab bottom navigation system and horizontal scrollable category filters

This approach provides a single codebase that runs perfectly in the browser for development/testing and compiles to native Android/iOS apps via Capacitor.

## Architecture

### Technology Stack

**Frontend Framework:**
- **React 18+** - Modern React with hooks and concurrent features
- **TypeScript** - Type safety across the entire codebase
- **Vite** - Lightning-fast dev server and build tool

**Styling:**
- **Tailwind CSS** - Utility-first CSS for rapid, responsive UI development
- **PostCSS** - For Tailwind processing

**Routing:**
- **React Router v6** - Standard web routing that works in browser and mobile
- **Custom Bottom Tab Navigation** - Integrated with React Router

**Native Capabilities:**
- **Capacitor 6** - Web-to-native bridge for iOS/Android
- **@capacitor/camera** - Camera access
- **@capacitor/filesystem** - File system access
- **@capacitor/app** - App lifecycle events

**State Management:**
- **React Context + Hooks** - For global state (theme, favorites, user)
- **Local State** - Component-level state with useState/useReducer

**Build & Deploy:**
- **Vite Build** - Optimized production builds for web
- **Capacitor Sync** - Syncs web build to native projects
- **Android Studio** - For Android APK/AAB compilation
- **Xcode** - For iOS IPA compilation

### Navigation Structure

```
App (React Router)
├── / (Home Layout with Bottom Tabs)
│   ├── /inicio (Home)
│   ├── /em-alta (Top Recipes)
│   ├── /favoritos (Favorites)
│   └── /assinatura (Profile/Subscription)
├── /receita/:id (Recipe Detail)
└── /categoria/:id (Category)
```

The architecture uses React Router for all navigation, with a custom bottom tab bar component that integrates seamlessly with the router.

### Project Structure

```
aquela-receita/
├── src/
│   ├── components/
│   │   ├── BottomTabBar.tsx
│   │   ├── CategoryItem.tsx
│   │   ├── RecipeCard.tsx
│   │   └── Icon.tsx
│   ├── pages/
│   │   ├── Home.tsx
│   │   ├── TopRecipes.tsx
│   │   ├── Favorites.tsx
│   │   ├── Profile.tsx
│   │   ├── RecipeDetail.tsx
│   │   └── Category.tsx
│   ├── layouts/
│   │   └── MainLayout.tsx
│   ├── contexts/
│   │   ├── ThemeContext.tsx
│   │   └── FavoritesContext.tsx
│   ├── data/
│   │   └── recipes.ts
│   ├── assets/
│   │   └── icons/
│   ├── App.tsx
│   ├── main.tsx
│   └── index.css
├── public/
│   └── icons/
├── android/ (generated by Capacitor)
├── ios/ (generated by Capacitor)
├── capacitor.config.ts
├── vite.config.ts
├── tailwind.config.js
├── tsconfig.json
└── package.json
```

## Components and Interfaces

### 1. Icon Component

**Location:** `src/components/Icon.tsx`

A unified icon component that handles both SVG and PNG icons with selected/unselected states.

**Interface:**
```typescript
interface IconProps {
  name: 'home' | 'flame' | 'favorite' | 'profile' | 
        'salgados' | 'massas' | 'doces' | 'bolos' | 'bebidas' | 'saudavel';
  selected?: boolean;
  size?: number;
  className?: string;
}
```

**Implementation:**
- Uses inline SVG for category icons
- Dynamically switches between selected (filled) and unselected (outline) variants
- Applies Tailwind classes for sizing and colors

### 2. BottomTabBar Component

**Location:** `src/components/BottomTabBar.tsx`

Custom bottom navigation bar integrated with React Router.

**Interface:**
```typescript
interface TabConfig {
  path: string;
  label: string;
  icon: string;
}

const tabs: TabConfig[] = [
  { path: '/inicio', label: 'Início', icon: 'home' },
  { path: '/em-alta', label: 'Em alta', icon: 'flame' },
  { path: '/favoritos', label: 'Favoritos', icon: 'favorite' },
  { path: '/assinatura', label: 'Assinatura', icon: 'profile' },
];
```

**Features:**
- Uses `useLocation()` to determine active tab
- Renders icons with selected state based on current route
- Fixed positioning at bottom with safe area support
- Smooth transitions between tabs

### 3. CategoryItem Component

**Location:** `src/components/CategoryItem.tsx`

Reusable category pill for horizontal scroll.

**Interface:**
```typescript
interface CategoryItemProps {
  id: string;
  name: string;
  icon: string;
  selected: boolean;
  onClick: () => void;
}
```

**Styling:**
- Circular icon container with yellow background when selected
- Smooth hover and active states
- Accessible with proper ARIA labels

### 4. MainLayout Component

**Location:** `src/layouts/MainLayout.tsx`

Layout wrapper that includes the bottom tab bar.

**Features:**
- Renders children (page content)
- Includes BottomTabBar at bottom
- Handles safe area insets for mobile devices
- Provides consistent padding and spacing

## Data Models

### Recipe Interface

```typescript
interface Recipe {
  id: string;
  title: string;
  description: string;
  image: string;
  category: string;
  prepTime: number;
  servings: number;
  ingredients: string[];
  instructions: string[];
  isNew?: boolean;
}
```

### Category Interface

```typescript
interface Category {
  id: string;
  name: string;
  icon: string;
}

const CATEGORIES: Category[] = [
  { id: 'salgadas', name: 'Salgadas', icon: 'salgados' },
  { id: 'massas', name: 'Massas', icon: 'massas' },
  { id: 'doces', name: 'Doces', icon: 'doces' },
  { id: 'bolos', name: 'Bolos', icon: 'bolos' },
  { id: 'bebidas', name: 'Bebidas', icon: 'bebidas' },
  { id: 'saudaveis', name: 'Saudáveis', icon: 'saudavel' },
];
```

## Styling Strategy

### Tailwind Configuration

**Colors:**
```javascript
colors: {
  primary: '#FFCC00',
  dark: '#2F394A',
  gray: {
    100: '#F9FAFB',
    200: '#E5E7EB',
    400: '#9CA3AF',
  },
}
```

**Mobile-First Breakpoints:**
```javascript
screens: {
  'sm': '640px',
  'md': '768px',
  'lg': '1024px',
  'xl': '1280px',
}
```

### Component Styling Patterns

- Use Tailwind utility classes for 90% of styling
- Custom CSS only for complex animations or gradients
- Mobile-first approach: base styles for mobile, then `md:` and `lg:` for larger screens
- Consistent spacing using Tailwind's spacing scale

## Capacitor Integration

### Configuration

**capacitor.config.ts:**
```typescript
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.aquelarecita.app',
  appName: 'Aquela Receita',
  webDir: 'dist',
  server: {
    androidScheme: 'https'
  },
  plugins: {
    SplashScreen: {
      launchShowDuration: 2000,
      backgroundColor: '#FFCC00',
    },
  },
};

export default config;
```

### Native Features

**Camera Access:**
```typescript
import { Camera, CameraResultType } from '@capacitor/camera';

const takePicture = async () => {
  const image = await Camera.getPhoto({
    quality: 90,
    allowEditing: true,
    resultType: CameraResultType.Uri
  });
  return image.webPath;
};
```

## Error Handling

### Icon Loading
- Fallback to placeholder if icon not found
- Console warning in development mode
- Graceful degradation in production

### Navigation Errors
- 404 page for invalid routes
- Redirect to home on navigation errors
- Preserve user state during errors

### Network Errors
- Retry logic for failed requests
- Offline mode detection
- User-friendly error messages

## Performance Optimization

### Code Splitting
- Lazy load pages with React.lazy()
- Separate chunks for each route
- Preload critical routes

### Image Optimization
- WebP format with fallbacks
- Lazy loading for recipe images
- Responsive images with srcset

### Bundle Size
- Tree-shaking with Vite
- Remove unused Tailwind classes in production
- Minimize dependencies

## Testing Strategy

### Unit Tests (Vitest)
- Test individual components in isolation
- Mock React Router hooks
- Test icon rendering logic
- Test category selection state

### Integration Tests
- Test navigation flow between pages
- Test bottom tab bar integration
- Test category filtering

### E2E Tests (Playwright)
- Test complete user journeys
- Test on different screen sizes
- Test touch interactions

### Mobile Testing
- Test on Android emulator
- Test on iOS simulator
- Test on real devices
- Verify Capacitor plugin functionality

## Migration Strategy

### Phase 1: Setup New Project
1. Initialize Vite + React + TypeScript project
2. Configure Tailwind CSS
3. Setup Capacitor
4. Configure build tools

### Phase 2: Port Components
1. Convert React Native components to React web components
2. Replace React Native styles with Tailwind
3. Update icon system
4. Port data models

### Phase 3: Implement Navigation
1. Setup React Router
2. Create bottom tab bar
3. Implement page routing
4. Add transitions

### Phase 4: Testing & Polish
1. Test in browser
2. Build for production
3. Sync to Capacitor
4. Test on Android/iOS
5. Fix platform-specific issues

## Accessibility

- Semantic HTML elements
- ARIA labels for all interactive elements
- Keyboard navigation support
- Screen reader compatibility
- Sufficient color contrast (WCAG AA)
- Touch targets minimum 44x44px

## Browser Support

- Chrome/Edge (last 2 versions)
- Safari (last 2 versions)
- Firefox (last 2 versions)
- Mobile Safari (iOS 13+)
- Chrome Android (last 2 versions)

## Development Workflow

1. **Local Development**: Run `npm run dev` - test in browser
2. **Build**: Run `npm run build` - creates optimized dist/
3. **Sync Native**: Run `npx cap sync` - updates Android/iOS projects
4. **Android**: Open in Android Studio, build APK
5. **iOS**: Open in Xcode, build IPA

## Design Tokens

```css
:root {
  --color-primary: #FFCC00;
  --color-dark: #2F394A;
  --color-white: #FFFFFF;
  --color-gray-100: #F9FAFB;
  --color-gray-200: #E5E7EB;
  --color-gray-400: #9CA3AF;
  
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  
  --radius-sm: 0.25rem;
  --radius-md: 0.5rem;
  --radius-lg: 1rem;
  --radius-full: 9999px;
  
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
}
```
